<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KKday ç¦å²¡ä¸€æ—¥éŠ (ç„¡é˜¿è˜‡ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f9ff;
        }
        .card-highlight {
            ring: 4px;
            ring-opacity: 0.8;
            transform: scale(1.02);
            transition: all 0.3s ease;
        }
        
        /* Advanced Table Badges */
        .badge { display: inline-flex; align-items: center; padding: 0.125rem 0.5rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; white-space: nowrap; }
        .badge-green { background-color: #dcfce7; color: #166534; }
        .badge-yellow { background-color: #fef9c3; color: #854d0e; }
        .badge-red { background-color: #fee2e2; color: #991b1b; }
        .badge-blue { background-color: #dbeafe; color: #1e40af; }
        .badge-indigo { background-color: #e0e7ff; color: #3730a3; }
        .badge-pink { background-color: #fce7f3; color: #9d174d; }
        .badge-purple { background-color: #f3e8ff; color: #6b21a8; }
        .badge-cyan { background-color: #cffafe; color: #0e7490; }
        
        /* Table Optimization */
        .detail-row td { vertical-align: top; padding-top: 1rem; padding-bottom: 1rem; }
        
        /* Mobile Card Interaction */
        .mobile-card { transition: all 0.2s; }
        .mobile-card:active { transform: scale(0.98); }

        /* Poll Styles */
        .poll-bar-container { background-color: #e5e7eb; border-radius: 9999px; overflow: hidden; height: 1.5rem; position: relative; }
        .poll-bar { height: 100%; transition: width 1s ease-in-out; display: flex; align-items: center; justify-content: flex-end; padding-right: 0.5rem; color: white; font-size: 0.75rem; font-weight: bold; }
        .vote-btn:disabled { opacity: 0.5; cursor: not-allowed; background-color: #9ca3af; color: #fff; }
    </style>
    <script>
        function toggleDetail(id) {
            const detail = document.getElementById('detail-' + id);
            const icon = document.getElementById('icon-' + id);
            if (detail.classList.contains('hidden')) {
                detail.classList.remove('hidden');
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            } else {
                detail.classList.add('hidden');
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            }
        }
    </script>
</head>
<body class="text-gray-800">

    <!-- Navbar -->
    <nav class="bg-cyan-600 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <i class="fas fa-umbrella-beach text-2xl mr-2 text-yellow-300"></i>
                    <span class="font-bold text-xl">ä¹å·ä¸€æ—¥éŠ (ç„¡é˜¿è˜‡ç‰ˆ)</span>
                </div>
                <div class="text-sm hidden sm:block">KKday ç²¾é¸</div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="bg-cyan-700 text-white py-12 px-4 text-center">
        <h1 class="text-3xl md:text-4xl font-bold mb-4">ä¸å»ç«å±±å»å“ªç©ï¼Ÿ</h1>
        <p class="text-cyan-100 max-w-2xl mx-auto text-lg">
            ç²¾é¸ 5 æ¬¾ã€Œå®Œå…¨é¿é–‹é˜¿è˜‡ç«å±±ã€çš„ç†±é–€è¡Œç¨‹ï¼šæµ·æ™¯ç³¸å³¶ã€æ‡·èˆŠé–€å¸æ¸¯ã€æ°´é„‰æŸ³å·ï¼Œé‚„æœ‰æœ€ç¶“å…¸çš„ç”±å¸ƒé™¢ã€‚
        </p>

        <!-- Interactive Filter -->
        <div class="mt-8 bg-white/10 backdrop-blur-md p-6 rounded-xl max-w-5xl mx-auto border border-white/20">
            <h3 class="text-lg font-bold mb-4"><i class="fas fa-magic mr-2"></i>æ‚¨å–œæ­¡å“ªç¨®é¢¨æ ¼ï¼Ÿ</h3>
            <div class="flex flex-wrap justify-center gap-3" id="filters">
                <button onclick="highlight('classic')" class="filter-btn px-4 py-2 bg-white text-teal-700 rounded-full font-bold hover:bg-green-500 hover:text-white transition shadow">
                    <i class="fas fa-torii-gate mr-1"></i> ç¶“å…¸å¿…éŠ (ç”±å¸ƒé™¢)
                </button>
                <button onclick="highlight('photo')" class="filter-btn px-4 py-2 bg-white text-teal-700 rounded-full font-bold hover:bg-pink-400 hover:text-white transition shadow">
                    <i class="fas fa-camera mr-1"></i> ç¶²ç¾æ‹ç…§ (ç³¸å³¶)
                </button>
                <button onclick="highlight('history')" class="filter-btn px-4 py-2 bg-white text-teal-700 rounded-full font-bold hover:bg-blue-500 hover:text-white transition shadow">
                    <i class="fas fa-ship mr-1"></i> æ‡·èˆŠæ¸¯å£ (é–€å¸æ¸¯)
                </button>
                <button onclick="highlight('culture')" class="filter-btn px-4 py-2 bg-white text-teal-700 rounded-full font-bold hover:bg-orange-500 hover:text-white transition shadow">
                    <i class="fas fa-water mr-1"></i> æ–‡åŒ–é«”é©— (æŸ³å·)
                </button>
                <button onclick="highlight('train')" class="filter-btn px-4 py-2 bg-white text-teal-700 rounded-full font-bold hover:bg-purple-500 hover:text-white transition shadow">
                    <i class="fas fa-train mr-1"></i> å°ç«è»Š (é«˜åƒç©—)
                </button>
                <button onclick="resetHighlight()" class="px-4 py-2 bg-gray-700 text-white rounded-full font-bold hover:bg-gray-600 transition shadow">
                    é¡¯ç¤ºå…¨éƒ¨
                </button>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">

        <!-- SECTION 0: Voting Poll (Named + Fallback Mode + Reset) -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden mb-12 border border-gray-100">
            <div class="bg-gradient-to-r from-cyan-500 to-blue-500 p-4 text-white flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center">
                    <h2 id="poll-title" class="text-xl font-bold"><i class="fas fa-poll mr-2"></i>å¤§å®¶æœ€æƒ³å»å“ªè£¡ï¼Ÿ</h2>
                    <span class="ml-2 text-sm bg-white/20 px-3 py-1 rounded-full">ç´¯ç© <span id="total-votes">0</span> ç¥¨</span>
                    
                    <button onclick="resetPoll()" class="ml-3 text-xs bg-black/20 hover:bg-red-600/80 text-white px-2 py-1 rounded transition flex items-center" title="é‡ç½®æ‰€æœ‰æŠ•ç¥¨æ•¸æ“š">
                        <i class="fas fa-trash-alt mr-1"></i> é‡ç½®
                    </button>
                </div>
                <!-- Name Input -->
                <div class="flex items-center w-full md:w-auto">
                    <div class="relative w-full">
                        <i class="fas fa-user absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="text" id="voter-name" placeholder="è«‹è¼¸å…¥æ‚¨çš„æš±ç¨± (è¨˜åæŠ•ç¥¨)" 
                            class="pl-10 pr-4 py-2 rounded-full text-gray-800 text-sm focus:outline-none focus:ring-2 focus:ring-white/50 w-full md:w-64 border-none shadow-inner bg-white/90">
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 divide-y md:divide-y-0 md:divide-x divide-gray-100">
                <!-- Poll Bars -->
                <div class="p-6 md:col-span-2" id="poll-container">
                    <div class="text-center text-gray-500 py-8 flex flex-col items-center justify-center">
                        <i class="fas fa-circle-notch fa-spin text-2xl mb-2 text-cyan-500"></i>
                        <span>åˆå§‹åŒ–æŠ•ç¥¨é¸é …ä¸­...</span>
                    </div>
                </div>
                
                <!-- Recent Logs -->
                <div class="p-6 bg-gray-50/50">
                    <h3 class="text-sm font-bold text-gray-500 uppercase mb-3"><i class="fas fa-history mr-1"></i> æœ€æ–°æŠ•ç¥¨å‹•æ…‹</h3>
                    <div id="poll-logs" class="space-y-3 text-sm">
                        <div class="text-center text-gray-400 py-4">æš«ç„¡ç´€éŒ„</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- SECTION 1: å¡ç‰‡ç‰† (å¿«é€Ÿç€è¦½) -->
        <div class="flex items-center mb-6">
            <div class="h-8 w-2 bg-cyan-500 rounded-full mr-3"></div>
            <h2 class="text-2xl font-bold text-gray-800">ç²¾é¸è¡Œç¨‹å¡ç‰‡</h2>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-6 mb-16" id="card-container">
            
            <!-- 1. Classic North (119732) -->
            <div id="card-classic" class="tour-card bg-white rounded-2xl shadow-xl overflow-hidden flex flex-col border border-gray-100 ring-green-500">
                <div class="bg-green-600 text-white text-xs font-bold px-3 py-1 uppercase tracking-wide text-center">
                    ç¶“å…¸å¿…éŠ â€¢ æ–°æ‰‹é¦–é¸
                </div>
                <div class="p-6 flex-1 flex flex-col">
                    <div class="flex justify-between items-start mb-2"><span class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs font-mono font-bold">119732</span></div>
                    <div class="mb-3"><span class="text-2xl font-bold text-teal-600">NT$ 1,800</span> <span class="text-xs text-gray-500">èµ·</span></div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">ç”±å¸ƒé™¢ï¼†åˆ¥åºœï¼†å¤ªå®°åºœ</h3>
                    <div class="space-y-2 mb-6 flex-1 text-sm text-gray-700">
                        <div class="font-bold bg-green-50 p-1 rounded"><i class="fas fa-torii-gate text-green-600 w-5"></i> å¤ªå®°åºœå¤©æ»¿å®®</div>
                        <div class="font-bold bg-green-50 p-1 rounded"><i class="fas fa-shopping-bag text-green-600 w-5"></i> ç”±å¸ƒé™¢ (é‡‘é±—æ¹–)</div>
                        <div class="font-bold bg-green-50 p-1 rounded"><i class="fas fa-hot-tub text-green-600 w-5"></i> åˆ¥åºœç¶åœ°ç„</div>
                    </div>
                    <a href="https://www.kkday.com/zh-tw/product/119732" target="_blank" class="block w-full text-center bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">å‰å¾€è¨‚è³¼</a>
                </div>
            </div>

            <!-- 2. Itoshima (305739) -->
            <div id="card-photo" class="tour-card bg-white rounded-2xl shadow-xl overflow-hidden flex flex-col border border-gray-100 ring-pink-400">
                <div class="bg-pink-500 text-white text-xs font-bold px-3 py-1 uppercase tracking-wide text-center">
                    IGæ‰“å¡ â€¢ æµ·æ™¯ç¶²ç¾
                </div>
                <div class="p-6 flex-1 flex flex-col">
                    <div class="flex justify-between items-start mb-2"><span class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs font-mono font-bold">305739</span></div>
                    <div class="mb-3"><span class="text-2xl font-bold text-pink-500">NT$ 1,500</span> <span class="text-xs text-gray-500">èµ·</span></div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">ç³¸å³¶çµ•æ™¯ä¸€æ—¥éŠ</h3>
                    <div class="space-y-2 mb-6 flex-1 text-sm text-gray-700">
                        <div class="font-bold bg-pink-50 p-1 rounded"><i class="fas fa-camera text-pink-500 w-5"></i> æ«»äº•äºŒè¦‹æµ¦ (å¤«å©¦å²©)</div>
                        <div class="font-bold bg-pink-50 p-1 rounded"><i class="fas fa-tree text-pink-500 w-5"></i> é¾è²“æ£®æ— (èŠ¥å±‹å¤§é–€)</div>
                        <div class="text-gray-500"><i class="fas fa-umbrella-beach w-5"></i> æ¤°å­æ¨¹é¦éŸ†</div>
                    </div>
                    <a href="https://www.kkday.com/zh-tw/product/305739" target="_blank" class="block w-full text-center bg-pink-500 hover:bg-pink-600 text-white font-bold py-2 px-4 rounded-lg">å‰å¾€è¨‚è³¼</a>
                </div>
            </div>

            <!-- 3. Mojiko (304123) -->
            <div id="card-history" class="tour-card bg-white rounded-2xl shadow-xl overflow-hidden flex flex-col border border-gray-100 ring-blue-500">
                <div class="bg-blue-600 text-white text-xs font-bold px-3 py-1 uppercase tracking-wide text-center">
                    æ‡·èˆŠæ¸¯å£ â€¢ æµ·é®®ç¾é£Ÿ
                </div>
                <div class="p-6 flex-1 flex flex-col">
                    <div class="flex justify-between items-start mb-2"><span class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs font-mono font-bold">304123</span></div>
                    <div class="mb-3"><span class="text-2xl font-bold text-blue-600">NT$ 1,950</span> <span class="text-xs text-gray-500">èµ·</span></div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">é–€å¸æ¸¯ï¼†å”æˆ¶å¸‚å ´</h3>
                    <div class="space-y-2 mb-6 flex-1 text-sm text-gray-700">
                        <div class="font-bold bg-blue-50 p-1 rounded"><i class="fas fa-fish text-blue-600 w-5"></i> å”æˆ¶å¸‚å ´ (åƒå£½å¸)</div>
                        <div class="font-bold bg-blue-50 p-1 rounded"><i class="fas fa-archway text-blue-600 w-5"></i> é–€å¸æ¸¯æ‡·èˆŠå€</div>
                        <div class="text-gray-500"><i class="fas fa-water w-5"></i> è§’å³¶å¤§æ©‹ (çµ•æ™¯)</div>
                    </div>
                    <a href="https://www.kkday.com/zh-tw/product/304123" target="_blank" class="block w-full text-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">å‰å¾€è¨‚è³¼</a>
                </div>
            </div>

            <!-- 4. Yanagawa (538560) -->
            <div id="card-culture" class="tour-card bg-white rounded-2xl shadow-xl overflow-hidden flex flex-col border border-gray-100 ring-orange-400">
                <div class="bg-orange-500 text-white text-xs font-bold px-3 py-1 uppercase tracking-wide text-center">
                    æ°´é„‰éŠèˆ¹ â€¢ æ·±åº¦æ–‡åŒ–
                </div>
                <div class="p-6 flex-1 flex flex-col">
                    <div class="flex justify-between items-start mb-2"><span class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs font-mono font-bold">538560</span></div>
                    <div class="mb-3"><span class="text-2xl font-bold text-orange-500">NT$ 2,200</span> <span class="text-xs text-gray-500">èµ·</span></div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">æŸ³å·éŠèˆ¹ï¼†é›·å±±åƒå¦‚å¯º</h3>
                    <div class="space-y-2 mb-6 flex-1 text-sm text-gray-700">
                        <div class="font-bold bg-orange-50 p-1 rounded"><i class="fas fa-ship text-orange-500 w-5"></i> æŸ³å·éŠèˆ¹é«”é©—</div>
                        <div class="font-bold bg-orange-50 p-1 rounded"><i class="fas fa-vihara text-orange-500 w-5"></i> é›·å±±åƒå¦‚å¯º (ç´…è‘‰)</div>
                        <div class="text-gray-500"><i class="fas fa-utensils w-5"></i> é°»é­šé£¯ (è‡ªç†/æ¨è–¦)</div>
                    </div>
                    <a href="https://www.kkday.com/zh-tw/product/538560" target="_blank" class="block w-full text-center bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg">å‰å¾€è¨‚è³¼</a>
                </div>
            </div>

            <!-- 5. Deep Takachiho (181723) - KEPT -->
            <div id="card-train" class="tour-card bg-white rounded-2xl shadow-xl overflow-hidden flex flex-col border border-gray-100 ring-purple-500">
                <div class="bg-purple-600 text-white text-xs font-bold px-3 py-1 uppercase tracking-wide text-center">
                    æ·±åº¦ç¥è©± â€¢ å¤©ç©ºå°ç«è»Š
                </div>
                <div class="p-6 flex-1 flex flex-col">
                    <div class="flex justify-between items-start mb-2"><span class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs font-mono font-bold">181723</span></div>
                    <div class="mb-3"><span class="text-2xl font-bold text-teal-600">NT$ 1,600</span> <span class="text-xs text-gray-500">èµ·</span></div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">é«˜åƒç©—æ·±åº¦ï¼†å°ç«è»Š</h3>
                    <div class="space-y-2 mb-6 flex-1 text-sm text-gray-700">
                        <div class="font-bold bg-purple-50 p-1 rounded"><i class="fas fa-train text-purple-600 w-5"></i> å¤©ç©ºå°ç«è»Š (é¸è³¼)</div>
                        <div class="font-bold bg-purple-50 p-1 rounded"><i class="fas fa-torii-gate text-purple-600 w-5"></i> å¤©å²©æˆ¶ç¥ç¤¾ (æ·±åº¦)</div>
                        <div class="text-red-500 font-bold"><i class="fas fa-ban w-5"></i> ä¸å»é˜¿è˜‡ç«å±±</div>
                    </div>
                    <a href="https://www.kkday.com/zh-tw/product/181723" target="_blank" class="block w-full text-center bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg">å‰å¾€è¨‚è³¼</a>
                </div>
            </div>

        </div>

        <!-- SECTION 2: é€²éšè©³ç´°ç‰ˆæ¯”è¼ƒè¡¨ -->
        <div class="bg-cyan-800 text-white p-4 rounded-t-xl shadow-lg text-center">
            <h2 class="text-xl font-bold"><i class="fas fa-table mr-2"></i>5å¤§ ç„¡é˜¿è˜‡è¡Œç¨‹ æ·±åº¦è§£æ</h2>
            <p class="text-cyan-200 text-sm">äº¤é€šæ™‚é–“ã€é«”åŠ›æ¶ˆè€—ã€é©åˆå°è±¡ä¸€è¦½</p>
        </div>

        <div class="bg-white border-x border-b border-gray-200 rounded-b-xl p-4 md:p-6 shadow-lg">
            
            <!-- Legend -->
            <div class="bg-gray-50 p-3 rounded-lg border border-gray-200 mb-6 text-sm flex flex-wrap gap-4 items-center justify-center">
                <span class="font-bold text-gray-900">æŒ‡æ¨™èªªæ˜ï¼š</span>
                <span class="flex items-center"><i class="fas fa-shoe-prints text-yellow-500 mr-1"></i> é«”åŠ›</span>
                <span class="flex items-center"><i class="fas fa-clock text-blue-500 mr-1"></i> è»Šç¨‹(å–®ç¨‹)</span>
                <span class="flex items-center"><i class="fas fa-utensils text-green-500 mr-1"></i> é¤é£Ÿ</span>
            </div>

            <!-- Desktop View Table -->
            <div class="hidden md:block bg-white rounded-xl shadow-sm overflow-hidden border border-gray-200">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-gray-100 text-gray-600 text-sm uppercase tracking-wider border-b border-gray-200">
                            <th class="p-4 w-2/12">è¡Œç¨‹åç¨±</th>
                            <th class="p-4 w-3/12">è©³ç´°æ™¯é»</th>
                            <th class="p-4 w-1/12 text-center">é«”åŠ›</th>
                            <th class="p-4 w-1/12 text-center">è»Šç¨‹</th>
                            <th class="p-4 w-2/12">ç‰¹è‰²é«”é©—</th>
                            <th class="p-4 w-2/12">é©åˆå°è±¡</th>
                            <th class="p-4 w-1/12 text-center">é€£çµ</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100 text-sm text-gray-700">
                        
                        <!-- 1. Classic -->
                        <tr class="detail-row hover:bg-green-50 transition">
                            <td class="p-4">
                                <div class="font-bold text-gray-900 text-base">ç¶“å…¸å¿…éŠç·š</div>
                                <div class="text-xs text-green-600 mt-1">æ–°æ‰‹é¦–é¸</div>
                            </td>
                            <td class="p-4">
                                <ul class="list-disc list-inside space-y-1">
                                    <li>å¤ªå®°åºœå¤©æ»¿å®®</li>
                                    <li>ç”±å¸ƒé™¢ (é‡‘é±—æ¹–)</li>
                                    <li>åˆ¥åºœç¶åœ°ç„</li>
                                </ul>
                            </td>
                            <td class="p-4 text-center"><span class="badge badge-green">ğŸŒ¿ è¼•é¬†</span></td>
                            <td class="p-4 text-center text-xs">ç´„ 2.0 hr</td>
                            <td class="p-4">
                                <div class="mb-1"><span class="badge badge-green">â™¨ï¸ è¶³æ¹¯</span></div>
                                <div class="text-xs">é€›è¡—è³¼ç‰©ç‚ºä¸»</div>
                            </td>
                            <td class="p-4 text-xs text-gray-500">ç¬¬ä¸€æ¬¡ä¾†ç¦å²¡ï¼Œæƒ³ä¸€æ¬¡æ‰“å¡æœ€çŸ¥åæ™¯é»çš„äººã€‚</td>
                            <td class="p-4 text-center"><a href="https://www.kkday.com/zh-tw/product/119732" target="_blank" class="text-green-600 hover:text-green-800 font-bold underline">æŸ¥çœ‹</a></td>
                        </tr>

                        <!-- 2. Itoshima -->
                        <tr class="detail-row hover:bg-pink-50 transition">
                            <td class="p-4">
                                <div class="font-bold text-gray-900 text-base">ç³¸å³¶ç¶²ç¾ç·š</div>
                                <div class="text-xs text-pink-500 mt-1">æ‹ç…§æ‰“å¡</div>
                            </td>
                            <td class="p-4">
                                <ul class="list-disc list-inside space-y-1">
                                    <li>æ«»äº•äºŒè¦‹æµ¦ (æµ·ä¸­é³¥å±…)</li>
                                    <li>é¾è²“æ£®æ— (èŠ¥å±‹å¤§é–€)</li>
                                    <li>æ¤°å­æ¨¹é¦éŸ†</li>
                                </ul>
                            </td>
                            <td class="p-4 text-center"><span class="badge badge-green">ğŸŒ¿ è¼•é¬†</span></td>
                            <td class="p-4 text-center text-xs">ç´„ 0.8 hr</td>
                            <td class="p-4">
                                <div class="mb-1"><span class="badge badge-pink">ğŸ“· ç¶²ç¾ç…§</span></div>
                                <div class="text-xs">æµ·é‚Šæ•£æ­¥</div>
                            </td>
                            <td class="p-4 text-xs text-gray-500">å–œæ­¡æ‹ç…§ã€çœ‹æµ·ï¼Œä¸æƒ³åå¤ªä¹…è»Šçš„å¹´è¼•æ—ç¾¤/æƒ…ä¾¶ã€‚</td>
                            <td class="p-4 text-center"><a href="https://www.kkday.com/zh-tw/product/305739" target="_blank" class="text-pink-600 hover:text-pink-800 font-bold underline">æŸ¥çœ‹</a></td>
                        </tr>

                        <!-- 3. Mojiko -->
                        <tr class="detail-row hover:bg-blue-50 transition">
                            <td class="p-4">
                                <div class="font-bold text-gray-900 text-base">æ‡·èˆŠé–€å¸æ¸¯</div>
                                <div class="text-xs text-blue-600 mt-1">æµ·é®®ç¾é£Ÿ</div>
                            </td>
                            <td class="p-4">
                                <ul class="list-disc list-inside space-y-1">
                                    <li>å”æˆ¶å¸‚å ´ (é€±æœ«é™å®š)</li>
                                    <li>é–€å¸æ¸¯æ‡·èˆŠå€</li>
                                    <li>è§’å³¶å¤§æ©‹ (çµ•æ™¯)</li>
                                </ul>
                            </td>
                            <td class="p-4 text-center"><span class="badge badge-yellow">âš¡ ä¸­ç­‰</span></td>
                            <td class="p-4 text-center text-xs">ç´„ 1.5 hr</td>
                            <td class="p-4">
                                <div class="mb-1"><span class="badge badge-blue">ğŸ£ åƒæµ·é®®</span></div>
                                <div class="text-xs">è·¨è¶Šé—œé–€æµ·å³½</div>
                            </td>
                            <td class="p-4 text-xs text-gray-500">åƒè²¨å¿…å»ï¼æƒ³åƒæ–°é®®æ²³è±šã€å£½å¸ï¼Œå–œæ­¡å¾©å¤å»ºç¯‰çš„äººã€‚</td>
                            <td class="p-4 text-center"><a href="https://www.kkday.com/zh-tw/product/304123" target="_blank" class="text-blue-600 hover:text-blue-800 font-bold underline">æŸ¥çœ‹</a></td>
                        </tr>

                        <!-- 4. Yanagawa -->
                        <tr class="detail-row hover:bg-orange-50 transition">
                            <td class="p-4">
                                <div class="font-bold text-gray-900 text-base">æŸ³å·æ°´é„‰ç·š</div>
                                <div class="text-xs text-orange-500 mt-1">æ·±åº¦æ–‡åŒ–</div>
                            </td>
                            <td class="p-4">
                                <ul class="list-disc list-inside space-y-1">
                                    <li>æŸ³å·éŠèˆ¹ (èˆ¹å¤«åŸå”±)</li>
                                    <li>é›·å±±åƒå¦‚å¯º (æˆ–å¤§èˆˆå–„å¯º)</li>
                                    <li>é°»é­šé£¯ååº—</li>
                                </ul>
                            </td>
                            <td class="p-4 text-center"><span class="badge badge-green">ğŸŒ¿ è¼•é¬†</span></td>
                            <td class="p-4 text-center text-xs">ç´„ 1.2 hr</td>
                            <td class="p-4">
                                <div class="mb-1"><span class="badge badge-orange">ğŸš£ éŠèˆ¹</span></div>
                                <div class="text-xs">å¤è¹Ÿå·¡ç¦®</div>
                            </td>
                            <td class="p-4 text-xs text-gray-500">å–œæ­¡å®‰éœæ°›åœã€æ—¥å¼åº­åœ’ã€æƒ³é«”é©—å°èˆ¹éŠæ²³çš„é•·è¼©æˆ–æ–‡é’ã€‚</td>
                            <td class="p-4 text-center"><a href="https://www.kkday.com/zh-tw/product/538560" target="_blank" class="text-orange-600 hover:text-orange-800 font-bold underline">æŸ¥çœ‹</a></td>
                        </tr>

                        <!-- 5. Deep Takachiho -->
                        <tr class="detail-row hover:bg-purple-50 transition">
                            <td class="p-4">
                                <div class="font-bold text-gray-900 text-base">é«˜åƒç©—æ·±åº¦</div>
                                <div class="text-xs text-purple-600 mt-1">ç¥è©±/éµé“</div>
                            </td>
                            <td class="p-4">
                                <ul class="list-disc list-inside space-y-1">
                                    <li>é«˜åƒç©—å³½ (æ·±åº¦)</li>
                                    <li>å¤©å²©æˆ¶ç¥ç¤¾ (èƒ½é‡æ™¯é»)</li>
                                    <li><strong>å¤©ç©ºå°ç«è»Š</strong></li>
                                </ul>
                            </td>
                            <td class="p-4 text-center"><span class="badge badge-yellow">âš¡ ä¸­ç­‰</span></td>
                            <td class="p-4 text-center text-xs">ç´„ 3.0 hr</td>
                            <td class="p-4">
                                <div class="mb-1"><span class="badge badge-indigo">ğŸš‚ å°ç«è»Š</span></div>
                                <div class="text-xs">é«˜ç©ºéµæ©‹</div>
                            </td>
                            <td class="p-4 text-xs text-gray-500"><strong>å”¯ä¸€ä¸å»é˜¿è˜‡çš„æ·±å±±è¡Œç¨‹ã€‚</strong>æƒ³æ·±åº¦ç©é«˜åƒç©—ï¼Œä¸”é¡˜æ„åé•·é€”è»Šçš„äººã€‚</td>
                            <td class="p-4 text-center"><a href="https://www.kkday.com/zh-tw/product/181723" target="_blank" class="text-purple-600 hover:text-purple-800 font-bold underline">æŸ¥çœ‹</a></td>
                        </tr>

                    </tbody>
                </table>
            </div>
            
            <div class="mt-6 text-center text-gray-400 text-xs">
                è³‡æ–™ä¾†æºï¼šKKday å®˜ç¶²é é¢æ•´ç†ï¼Œå…§å®¹å¯èƒ½éš¨å­£ç¯€è®Šå‹•ï¼Œè«‹ä»¥è¨‚è³¼ç•¶ä¸‹è³‡è¨Šç‚ºæº–ã€‚
                <div class="mt-2 text-gray-500 font-bold">Ver 2.0 (Non-Aso Edition)</div>
            </div>

        </div>

        <div class="mt-8 text-center text-gray-500 text-sm">
            <p>â€» é‡‘é¡ç‚ºé ä¼°åƒè€ƒï¼Œå¯¦éš›åƒ¹æ ¼æœƒéš¨åŒ¯ç‡èˆ‡å­£ç¯€æ³¢å‹•ï¼Œè«‹ä¾ KKday å®˜ç¶²å³æ™‚è³‡è¨Šç‚ºä¸»ã€‚</p>
        </div>

    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-5 right-5 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-2xl transform translate-y-20 transition-transform duration-300 z-50 flex items-center">
        <i class="fas fa-check-circle text-green-400 mr-2"></i>
        <span>å·²ç‚ºæ‚¨ç¯©é¸ï¼</span>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, updateDoc, increment, setDoc, getDoc, collection, arrayUnion } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- è¨­å®šèˆ‡è®Šæ•¸ ---
        // ä¿®æ”¹é€™å€‹ç‰ˆæœ¬è™Ÿä¾†é‡ç½®æŠ•ç¥¨ (ä¾‹å¦‚æ”¹ç‚º 'v2')
        const POLL_VERSION = 'v2'; 
        
        // Poll Options Configuration - 5 items (Non-Aso)
        const pollOptions = [
            { id: '119732', name: 'ç¶“å…¸å¿…éŠç·š (ç”±å¸ƒé™¢)', color: 'bg-green-600' },
            { id: '305739', name: 'ç³¸å³¶ç¶²ç¾ç·š', color: 'bg-pink-500' },
            { id: '304123', name: 'æ‡·èˆŠé–€å¸æ¸¯', color: 'bg-blue-600' },
            { id: '538560', name: 'æŸ³å·æ°´é„‰ç·š', color: 'bg-orange-500' },
            { id: '181723', name: 'é«˜åƒç©—æ·±åº¦ï¼†å°ç«è»Š', color: 'bg-purple-600' }
        ];

        let db, auth, appId;
        let isLocalMode = false;

        // 1. Initial Render (Show UI immediately)
        function renderInitialUI() {
             renderPoll({}); 
             document.getElementById('poll-logs').innerHTML = '<div class="text-center text-gray-400 py-4">è¼‰å…¥å³æ™‚å‹•æ…‹ä¸­...</div>';
        }

        // 2. Initialize System
        async function initSystem() {
            try {
                // User provided config
                const firebaseConfig = {
                    apiKey: "AIzaSyAGHMP1HLJJPRQD_9CXnwI6lQwkcbZNm8M",
                    authDomain: "fukuoka-tour-vote.firebaseapp.com",
                    projectId: "fukuoka-tour-vote",
                    storageBucket: "fukuoka-tour-vote.firebasestorage.app",
                    messagingSenderId: "997387578824",
                    appId: "1:997387578824:web:1006cda95b7fe7508d24fd"
                };

                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                
                // Use fixed ID + Version for data location
                appId = 'fukuoka-public-vote-' + POLL_VERSION; 

                // Auth Flow
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }

                // Wait for Auth
                await new Promise((resolve, reject) => {
                    const unsubscribe = onAuthStateChanged(auth, (user) => {
                        if (user) { unsubscribe(); resolve(user); }
                    }, (err) => reject(err));
                });

                // Listen to Real DB
                const pollRef = doc(db, 'artifacts', appId, 'public', 'data', 'poll_results', 'current');
                
                // Use onSnapshot immediately without blocking check
                onSnapshot(pollRef, (docSnap) => {
                    const data = docSnap.exists() ? docSnap.data() : {};
                    renderPoll(data);
                    renderLogs(data.logs || []);
                }, (error) => {
                    console.warn("Snapshot failed, falling back to local:", error);
                    initLocalMode();
                });

            } catch (error) {
                console.log("Firebase init failed or local mode requested:", error);
                initLocalMode();
            }
        }

        // 3. Local Mode Logic (Fallback)
        function initLocalMode() {
            isLocalMode = true;
            console.log("Running in Local Mode");
            
            // Show indicator safely using ID
            const titleContainer = document.getElementById('poll-title');
            if(titleContainer && !titleContainer.innerHTML.includes('å–®æ©Ÿ')) {
                 titleContainer.innerHTML += ' <span class="text-xs bg-white/20 px-2 py-1 rounded ml-2 border border-white/30">(å–®æ©Ÿç‰ˆ)</span>';
            }

            // Load data from localStorage
            loadLocalData();
        }

        function loadLocalData() {
            // Include version in local storage key to support reset
            const localData = JSON.parse(localStorage.getItem('kkday_poll_data_' + POLL_VERSION) || '{"logs": []}');
            renderPoll(localData);
            renderLogs(localData.logs || []);
        }

        // 4. Reset Function (Global/Local)
        window.resetPoll = async () => {
            if(!confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰æŠ•ç¥¨æ•¸æ“šå—ï¼Ÿé€™å°‡æ¸…é™¤æ‰€æœ‰äººçš„æŠ•ç¥¨ç´€éŒ„ã€‚')) return;

            // Clear local locks
            localStorage.removeItem(`has_voted_${POLL_VERSION}`);
            pollOptions.forEach(opt => localStorage.removeItem(`voted_${opt.id}_${POLL_VERSION}`));

            if(isLocalMode) {
                // Local Mode Reset
                localStorage.removeItem('kkday_poll_data_' + POLL_VERSION);
                loadLocalData();
                alert('æœ¬åœ°æ•¸æ“šå·²é‡ç½®ï¼');
            } else {
                // Firebase Reset
                try {
                    const pollRef = doc(db, 'artifacts', appId, 'public', 'data', 'poll_results', 'current');
                    // Reset doc to empty or initial state - overwrite with empty logs
                    await setDoc(pollRef, { logs: [] }); 
                    // Note: count fields will be removed by setDoc without merge:true
                    alert('å…¨åŸŸæŠ•ç¥¨æ•¸æ“šå·²é‡ç½®ï¼');
                } catch(e) {
                    console.error(e);
                    alert('é‡ç½®å¤±æ•—ï¼Œè«‹æª¢æŸ¥æ¬Šé™');
                }
            }
        };

        // 5. Vote Handler
        window.vote = async (id) => {
            const nameInput = document.getElementById('voter-name');
            const name = nameInput.value.trim();

            if (!name) {
                alert('è«‹å…ˆè¼¸å…¥æ‚¨çš„æš±ç¨±ï¼Œæ‰èƒ½é€²è¡Œè¨˜åæŠ•ç¥¨å–”ï¼');
                nameInput.focus();
                return;
            }

            // Check restriction: One vote per device (browser) for this POLL_VERSION
            if (localStorage.getItem(`has_voted_${POLL_VERSION}`)) {
                alert(`æ‚¨å·²ç¶“åœ¨æœ¬è£ç½®æŠ•éç¥¨å›‰ï¼è‹¥è¦é‡æŠ•è«‹é»æ“Šæ¨™é¡Œæ—çš„é‡ç½®æŒ‰éˆ•ã€‚`);
                return;
            }

            // Optimistic UI update trigger
            localStorage.setItem(`has_voted_${POLL_VERSION}`, 'true');
            // Also set per-option for button UI state
            localStorage.setItem(`voted_${id}_${POLL_VERSION}`, 'true');

            if (isLocalMode) {
                // Handle Local Vote
                const localData = JSON.parse(localStorage.getItem('kkday_poll_data_' + POLL_VERSION) || '{"logs": []}');
                
                // Increment count
                localData['count_' + id] = (localData['count_' + id] || 0) + 1;
                
                // Add log
                if (!localData.logs) localData.logs = [];
                localData.logs.push({
                    name: name,
                    optionId: id,
                    timestamp: Date.now()
                });

                localStorage.setItem('kkday_poll_data_' + POLL_VERSION, JSON.stringify(localData));
                loadLocalData(); // Re-render
                
            } else {
                // Handle Firebase Vote
                try {
                    const pollRef = doc(db, 'artifacts', appId, 'public', 'data', 'poll_results', 'current');
                    
                    // Create doc if needed logic is handled by setDoc with merge
                    await setDoc(pollRef, {
                        ['count_' + id]: increment(1),
                        logs: arrayUnion({
                            name: name,
                            optionId: id,
                            timestamp: Date.now()
                        })
                    }, { merge: true });
                } catch (e) {
                    console.error("Vote failed", e);
                    alert("é€£ç·šå¤±æ•—ï¼Œåˆ‡æ›ç‚ºå–®æ©Ÿæ¨¡å¼");
                    // Revert lock
                    localStorage.removeItem(`has_voted_${POLL_VERSION}`);
                    
                    initLocalMode(); // Fallback on failure
                }
            }
        };

        // Render Functions
        function renderPoll(data) {
            const container = document.getElementById('poll-container');
            const totalDisplay = document.getElementById('total-votes');
            
            let totalVotes = 0;
            pollOptions.forEach(opt => {
                totalVotes += (data['count_' + opt.id] || 0);
            });
            
            if(totalDisplay) totalDisplay.innerText = totalVotes;

            let html = '';
            pollOptions.forEach(opt => {
                const count = data['count_' + opt.id] || 0;
                const percentage = totalVotes === 0 ? 0 : Math.round((count / totalVotes) * 100);
                // Check if voted specifically for this option in this version (for UI highlight)
                const hasVotedThis = localStorage.getItem(`voted_${opt.id}_${POLL_VERSION}`);
                // Check if voted at all (to disable other buttons)
                const hasVotedAny = localStorage.getItem(`has_voted_${POLL_VERSION}`);
                
                // Safety check for width to avoid layout break
                const barWidth = percentage < 1 ? 1 : percentage; 

                html += `
                    <div class="mb-3">
                        <div class="flex justify-between items-center mb-1">
                            <span class="font-bold text-gray-700 text-sm">${opt.name}</span>
                            <span class="text-xs text-gray-500">${count} ç¥¨ (${percentage}%)</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="flex-grow poll-bar-container bg-gray-200 rounded-full h-4 overflow-hidden relative">
                                <div class="poll-bar ${opt.color} h-full transition-all duration-1000 ease-out" style="width: ${barWidth}%"></div>
                            </div>
                            <button onclick="vote('${opt.id}')" 
                                class="vote-btn px-3 py-1 rounded text-xs font-bold transition shadow ${hasVotedThis ? 'bg-gray-800 text-white' : (hasVotedAny ? 'bg-gray-300 text-gray-500' : 'text-white ' + opt.color + ' hover:brightness-110')}"
                                ${hasVotedAny ? 'disabled' : ''}>
                                ${hasVotedThis ? 'å·²æŠ•' : 'æŠ•ç¥¨'}
                            </button>
                        </div>
                    </div>
                `;
            });
            if(container) container.innerHTML = html;
        }

        function renderLogs(logs) {
            const logsContainer = document.getElementById('poll-logs');
            if (!logsContainer) return;
            
            if (!logs || logs.length === 0) {
                logsContainer.innerHTML = '<div class="text-center text-gray-400 py-4">æš«ç„¡ç´€éŒ„ï¼Œå¿«ä¾†æŠ•ç¬¬ä¸€ç¥¨ï¼</div>';
                return;
            }

            const recentLogs = logs.sort((a, b) => b.timestamp - a.timestamp).slice(0, 5);

            let html = '';
            recentLogs.forEach(log => {
                const option = pollOptions.find(o => o.id === log.optionId);
                const colorClass = option ? option.color.replace('bg-', 'text-') : 'text-gray-600';
                
                // Time formatting
                const now = Date.now();
                const diffMs = now - log.timestamp;
                const diffMins = Math.floor(diffMs / 60000);
                let timeText = 'å‰›å‰›';
                if (diffMins > 0) {
                    if (diffMins < 60) timeText = `${diffMins} åˆ†é˜å‰`;
                    else timeText = `${Math.floor(diffMins/60)} å°æ™‚å‰`;
                }

                // Sanitize input to prevent XSS (basic)
                const safeName = (log.name || 'åŒ¿å').replace(/</g, "&lt;").replace(/>/g, "&gt;");

                html += `
                    <div class="flex items-center justify-between border-b border-gray-100 pb-2 last:border-0">
                        <div class="flex items-center">
                            <div class="w-2 h-2 rounded-full ${option ? option.color : 'bg-gray-400'} mr-2"></div>
                            <div>
                                <span class="font-bold text-gray-700 text-xs">${safeName}</span>
                                <span class="text-xs text-gray-400 transform scale-90 origin-left inline-block">æŠ•çµ¦äº†</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="font-bold text-xs ${colorClass}">${option ? option.name : 'æœªçŸ¥è¡Œç¨‹'}</span>
                            <div class="text-[10px] text-gray-400">${timeText}</div>
                        </div>
                    </div>
                `;
            });
            logsContainer.innerHTML = html;
        }

        // Highlighting Logic (Feature)
        function highlight(type) {
            resetStyles();
            
            // Map button types to card IDs
            const mapping = {
                'classic': ['card-classic'], 
                'photo': ['card-photo'],
                'history': ['card-history'], 
                'culture': ['card-culture'],
                'train': ['card-train'], // Deep Takachiho
            };

            const target = mapping[type];

            const cards = document.querySelectorAll('.tour-card');
            cards.forEach(c => {
                let shouldHighlight = false;
                if (Array.isArray(target)) {
                    if (target.includes(c.id)) shouldHighlight = true;
                } else if (c.id === target) {
                    shouldHighlight = true;
                }

                if (shouldHighlight) {
                    c.classList.add('card-highlight');
                } else {
                    c.classList.add('opacity-40');
                }
            });
        }

        function resetHighlight() {
            resetStyles();
        }

        function resetStyles() {
            const cards = document.querySelectorAll('.tour-card');
            cards.forEach(card => {
                card.classList.remove('card-highlight', 'opacity-40');
                card.classList.add('opacity-100');
            });
        }

        // Start
        renderInitialUI();
        initSystem();
    </script>
</body>
</html>


